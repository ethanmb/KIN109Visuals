<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Confidence Interval Practice: Paired or Independent Samples</title>
  <style>
    .canvas-lms-style {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    #feedback {
      margin-top: 10px;
      font-weight: bold;
    }
    #regenerate-button {
      display: none; /* Initially hidden */
      margin-top: 20px;
    }
  </style>
</head>
<body>
<!-- Include jStat library for t-distribution calculations -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.4/jstat.min.js"></script>

<div class="canvas-lms-style">
  <h3>Confidence Interval Practice Problem: Paired or Independent Samples</h3>
  
  <p id="question-text"></p>
  
  <p><strong>Step 1: Identify the sample type.</strong></p>
  <p>Is this problem using paired samples or independent samples?</p>
  <select id="sample-type-choice">
    <option value="">--Select--</option>
    <option value="paired">Paired Samples</option>
    <option value="independent">Independent Samples</option>
  </select>
  
  <button onclick="checkSampleType()">Submit Sample Type</button>

  <div id="step-2" style="display:none;">
    <p><strong>Step 2: Identify the critical value</strong></p>
    <p>What is the critical value for a <span id="confidence-level"></span>% confidence interval?</p>
    <input type="number" id="student-critical-value" step="0.001">
    <button onclick="checkCriticalValue()">Submit Critical Value</button>
  </div>

  <div id="step-3" style="display:none;">
    <p><strong>Step 3: Calculate the margin of error.</strong></p>
    <p>Your calculated margin of error: <input type="number" id="student-margin-error" step="0.01"></p>
    <button onclick="checkMarginError()">Submit Margin of Error</button>
  </div>

  <div id="step-4" style="display:none;">
    <p><strong>Step 4: Calculate the confidence interval bounds.</strong></p>
    <p>Enter the confidence interval in the format [lower bound, upper bound]:</p>
    <p><input type="number" id="lower-bound" step="0.01"> , <input type="number" id="upper-bound" step="0.01"></p>
    <button onclick="checkConfidenceInterval()">Submit Confidence Interval</button>
  </div>

  <div id="feedback"></div>
  <button id="regenerate-button" onclick="generateNewProblem()">Regenerate Problem</button>
</div>

<script>
let sampleType, confidenceLevel, criticalValue, marginError;
let meanDifference, stdDevDifference, sampleSize;
let mean1, mean2, stdDev1, stdDev2, sampleSize1, sampleSize2;
let correctLower, correctUpper;

function generateNewProblem() {
    // Reset visibility and feedback
    document.getElementById('step-2').style.display = 'none';
    document.getElementById('step-3').style.display = 'none';
    document.getElementById('step-4').style.display = 'none';
    document.getElementById('regenerate-button').style.display = 'none';
    document.getElementById('feedback').innerText = '';
    document.getElementById('sample-type-choice').value = '';
    document.getElementById('student-critical-value').value = '';
    document.getElementById('student-margin-error').value = '';
    document.getElementById('lower-bound').value = '';
    document.getElementById('upper-bound').value = '';

    const confidenceLevels = [90, 95, 99];
    confidenceLevel = confidenceLevels[Math.floor(Math.random() * confidenceLevels.length)];
    document.getElementById('confidence-level').innerText = confidenceLevel;

    if (Math.random() < 0.5) {
        // Paired samples
        sampleType = "paired";
        sampleSize = Math.floor(Math.random() * 10 + 5);
        meanDifference = (Math.random() * 10).toFixed(2);
        stdDevDifference = (Math.random() * 5 + 1).toFixed(2);

        // Calculate t-value for paired samples
        const stdError = stdDevDifference / Math.sqrt(sampleSize);
        const tValue = (meanDifference / stdError).toFixed(2);

        // Paired sample scenarios without directly saying "paired"
        const pairedScenarios = [
            `A study measured participants' responses to a treatment before and after it was administered. The difference in responses had a mean of ${meanDifference} and a standard deviation of ${stdDevDifference} for a sample of ${sampleSize} participants. The calculated t-value for this difference is ${tValue}. Calculate a ${confidenceLevel}% confidence interval for the mean difference in response.`,
            `In an experiment, each participant was tested under two different conditions. The average change between conditions was ${meanDifference} with a standard deviation of ${stdDevDifference}, based on data from ${sampleSize} individuals. The calculated t-value is ${tValue}. Calculate a ${confidenceLevel}% confidence interval for the average difference between conditions.`,
        ];
        document.getElementById('question-text').innerText = pairedScenarios[Math.floor(Math.random() * pairedScenarios.length)];

    } else {
        // Independent samples
        sampleType = "independent";
        sampleSize1 = Math.floor(Math.random() * 10 + 5);
        sampleSize2 = Math.floor(Math.random() * 10 + 5);
        mean1 = (Math.random() * 20 + 50).toFixed(2);
        mean2 = (Math.random() * 20 + 50).toFixed(2);
        stdDev1 = (Math.random() * 5 + 1).toFixed(2);
        stdDev2 = (Math.random() * 5 + 1).toFixed(2);

        // Calculate t-value for independent samples
        const meanDifferenceIndependent = (parseFloat(mean1) - parseFloat(mean2)).toFixed(2);
        const stdError = Math.sqrt((Math.pow(stdDev1, 2) / sampleSize1) + (Math.pow(stdDev2, 2) / sampleSize2));
        const tValue = (meanDifferenceIndependent / stdError).toFixed(2);

        // Independent sample scenarios without directly saying "independent"
        const independentScenarios = [
            `Two groups were given different conditions to test their effect. Group 1 had an average score of ${mean1} with a standard deviation of ${stdDev1} (sample size ${sampleSize1}), while Group 2 had an average score of ${mean2} with a standard deviation of ${stdDev2} (sample size ${sampleSize2}). The calculated t-value for the difference is ${tValue}. Calculate a ${confidenceLevel}% confidence interval for the difference in group means.`,
            `In a comparative study, two distinct groups showed mean values of ${mean1} and ${mean2} with standard deviations of ${stdDev1} and ${stdDev2}, respectively. The sample sizes were ${sampleSize1} for Group 1 and ${sampleSize2} for Group 2. The calculated t-value for this difference is ${tValue}. Determine a ${confidenceLevel}% confidence interval for the difference between the groups' mean values.`
        ];
        document.getElementById('question-text').innerText = independentScenarios[Math.floor(Math.random() * independentScenarios.length)];
    }
}




function checkSampleType() {
  let selectedSampleType = document.getElementById('sample-type-choice').value;
  if (selectedSampleType === sampleType) {
    document.getElementById('feedback').innerText = "Correct! Now, identify the critical value.";
    document.getElementById('feedback').style.color = 'green';
    document.getElementById('step-2').style.display = 'block';
  } else {
    document.getElementById('feedback').innerText = `Incorrect. This problem uses ${sampleType} samples.`;
    document.getElementById('feedback').style.color = 'red';
  }
}

// Updated Step 2 with t-distribution critical values for small samples
function checkCriticalValue() {
    let studentCriticalValue = parseFloat(document.getElementById('student-critical-value').value);
    
    // Calculate critical value dynamically using degrees of freedom
    const df = sampleType === 'paired' ? sampleSize - 1 : Math.floor((Math.pow(stdDev1, 2) / sampleSize1 + Math.pow(stdDev2, 2) / sampleSize2) ** 2 /
                   (((Math.pow(stdDev1, 2) / sampleSize1) ** 2) / (sampleSize1 - 1) + ((Math.pow(stdDev2, 2) / sampleSize2) ** 2) / (sampleSize2 - 1)));
  
    // Compute t critical value
    criticalValue = jStat.studentt.inv(1 - (1 - confidenceLevel / 100) / 2, df); // Example using jStat for critical value based on df
  
    // Comparison with tolerance for potential small floating-point differences
    if (Math.abs(studentCriticalValue - criticalValue) <= 0.01) {
      document.getElementById('feedback').innerText = "Correct! Now, calculate the margin of error.";
      document.getElementById('feedback').style.color = 'green';
      document.getElementById('step-3').style.display = 'block';
    } else {
      document.getElementById('feedback').innerText = `Incorrect. The correct critical value is ${criticalValue.toFixed(3)}.`;
      document.getElementById('feedback').style.color = 'red';
    }
  }
  

function checkMarginError() {
  let studentMarginError = parseFloat(document.getElementById('student-margin-error').value);
  let stdError;
  
  if (sampleType === 'paired') {
    stdError = stdDevDifference / Math.sqrt(sampleSize);
  } else {
    stdError = Math.sqrt((stdDev1 ** 2 / sampleSize1) + (stdDev2 ** 2 / sampleSize2));
  }
  marginError = (criticalValue * stdError).toFixed(2);

  if (Math.abs(studentMarginError - marginError) <= 0.01) {
    document.getElementById('feedback').innerText = "Correct! Now, calculate the confidence interval.";
    document.getElementById('feedback').style.color = 'green';
    document.getElementById('step-4').style.display = 'block';
  } else {
    document.getElementById('feedback').innerText = `Incorrect. The correct margin of error is ${marginError}.`;
    document.getElementById('feedback').style.color = 'red';
  }
}

function checkConfidenceInterval() {
  let lowerBound = parseFloat(document.getElementById('lower-bound').value);
  let upperBound = parseFloat(document.getElementById('upper-bound').value);

  if (sampleType === 'paired') {
    correctLower = (parseFloat(meanDifference) - parseFloat(marginError)).toFixed(2);
    correctUpper = (parseFloat(meanDifference) + parseFloat(marginError)).toFixed(2);
  } else {
    let meanDifferenceIndependent = (parseFloat(mean1) - parseFloat(mean2)).toFixed(2);
    correctLower = (parseFloat(meanDifferenceIndependent) - parseFloat(marginError)).toFixed(2);
    correctUpper = (parseFloat(meanDifferenceIndependent) + parseFloat(marginError)).toFixed(2);
  }

  if (Math.abs(lowerBound - correctLower) <= 0.01 && Math.abs(upperBound - correctUpper) <= 0.01) {
    document.getElementById('feedback').innerText = "Correct! You have successfully calculated the confidence interval.";
    document.getElementById('feedback').style.color = 'green';
    document.getElementById('regenerate-button').style.display = 'block'; // Show the regenerate button
  } else {
    document.getElementById('feedback').innerText = `Incorrect. The correct confidence interval is [${correctLower}, ${correctUpper}].`;
    document.getElementById('feedback').style.color = 'red';
  }
}

generateNewProblem(); // Initialize the first problem on page load
</script>

</body>
</html>
